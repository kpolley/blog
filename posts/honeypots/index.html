<!doctype html><html xmlns=http://www.w3.org/1999/xhtml lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<title>Bringing D&R to New Heights with Honeypots | Kyle Polley</title>
<link href=https://kpolley.github.io/blog/index.xml rel=alternate type=application/rss+xml title="Kyle Polley">
<link rel=stylesheet href=/blog/css/style.css><link rel=stylesheet href=https://kpolley.github.io/blog/css/custom.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<link rel=canonical href=https://kpolley.github.io/blog/posts/honeypots/>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff">
</head>
<body>
<section class=section>
<div class=container>
<nav id=nav-main class=nav>
<div id=nav-name class=nav-left>
<a id=nav-anchor class=nav-item href=https://kpolley.github.io/blog>
<h1 id=nav-heading class="title is-4">Kyle Polley</h1>
</a>
</div>
<div class=nav-right>
<nav id=nav-items class="nav-item level is-mobile"><a class=level-item aria-label=twitter href=https://twitter.com/KP0113Y target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></i>
</span>
</a><a class=level-item aria-label=github href=https://github.com/kpolley target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></i>
</span>
</a><a class=level-item aria-label=linkedin href=https://linkedin.com/in/kylepolley target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path stroke-width="1.8" d="m5.839218 4.101561c0 1.211972-.974141 2.194011-2.176459 2.194011S1.4863 5.313533 1.4863 4.101561c0-1.211094.974141-2.194011 2.176459-2.194011s2.176459.982917 2.176459 2.194011zm.017552 3.94922H1.468748v14.04167H5.85677V8.050781zm7.005038.0H8.501869v14.04167h4.360816v-7.370999c0-4.098413 5.291077-4.433657 5.291077.0v7.370999h4.377491v-8.89101c0-6.915523-7.829986-6.66365-9.669445-3.259423V8.050781z"/></svg></i>
</span>
</a><a class=level-item aria-label=rss href=/index.xml target=_blank rel=noopener>
<span class=icon>
<i><svg viewbox="0 0 24 24" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" aria-hidden="true"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></i>
</span>
</a></nav>
</div>
</nav>
<nav class=nav>
</nav>
</div>
<script src=/js/navicon-shift.js></script>
</section>
<section class=section>
<div class=container>
<div class="subtitle tags is-6 is-pulled-right">
</div>
<h2 class="subtitle is-6">February 11, 2022</h2>
<h1 class=title>Bringing D&R to New Heights with Honeypots</h1>
<div class=content>
<p><em>Why honeypots should be included at the core of a D&R program</em></p>
<h1 id=traditional-detection-eng>Traditional Detection Eng.</h1>
<p>There are plenty of resources out there such as the MITRE ATT&CK Matrix which describe common attack behaviors. Any Detection and Response (D&R) engineer could decribe in great detail multiple ways an attacker could move across their environment. They could even tell you what the attacker would likely target!</p>
<p>So why is detecting malicious activity such a difficult task? The problem is that there are <em>so</em> many ways to move laterally, escalate privileges, and exfiltrate data. On top of that, attackers leverage tools that are the same tools most engineers use to do their job such as <code>curl</code>, <code>ssh</code>, <code>nmap</code>, and <code>powershell</code>. <strong>The only difference between attacker behavior and benign behavior is intent  &ndash;  and intent is incredibly hard to detect.</strong></p>
<pre tabindex=0><code>$ curl http://169.254.169.254/latest/meta-data/
</code></pre>
<p style=text-align:center>
<i>is this an attacker stealing AWS creds or an engineer debugging?</i>
</p>
<h1 id=policy-based-detections>Policy-based Detections</h1>
<p>Something I&rsquo;ve noticed recently though &ndash; the best detections do not detect intent, but detect <strong>policy violations</strong>. I define a policy-based detection to be a detection which is triggered when an event that should never happens, happens.</p>
<p>For example:</p>
<ul>
<li>If your org forbids the use of the <code>root</code> AWS account, then write a detection that triggers when the <code>root</code> account is used. You&rsquo;ve just built a fantastic alert that will generate high signal for <em>compromised credentials!</em></li>
<li>If your org forbids the use of <code>powershell</code> on CX agent machines, then write a detection that triggers when <code>powershell</code> is used on an CX agent machine. It is a great detection for <em>execution</em> attempts!</li>
</ul>
<p>Policy-based detections are great because they are super easy to write and deploy. More importantly though, <strong>policy-based detections leverage one of the greatest advantages most D&R teams don&rsquo;t even realize they have  &ndash;  knowledge and control over the environment they are hired to protect.</strong></p>
<p>Attackers entering the environment for the first time have no idea where they are or what the environment looks like. Policy-based detections use that advantage to cause the attacker to reveal themselves.</p>
<h1 id=intrusion-detection-honeypots>Intrusion Detection Honeypots</h1>
<p>The issue with policy-based detections is that there needs to be a policy that can be violated. This limitation restricts D&R teams from really taking advantage of policy-based detections across the org, especially in very open environments such as a typical development env.</p>
<p>An Intrusion Detection Honeypot (IDH) is a resource created for the purpose of triggering an alert when they are probed, used, or compromised. <strong>IDH&rsquo;s has the same benefits as policy-based detections, but it allows D&R teams to <em><strong>create</strong></em> policies which can be scattered across your environment.</strong></p>
<p>For example:</p>
<ul>
<li><em>Honey servers</em> are servers that can be placed in your environment that should never be probed.
<ul>
<li>Honey servers could detect <em>discovery</em>.</li>
</ul>
</li>
<li><em>Honey tokens</em> are tokens such as API keys and AWS credentials scattered across your environment which should never be used.
<ul>
<li>Honey tokens could detect <em>lateral movement</em>  </li>
</ul>
</li>
<li><em>Honey Resources</em> are resources such as database tables, S3 buckets, Word documents, and PDFs which should never be read or downloaded.
<ul>
<li>Honey resources could detect <em>collection</em></li>
</ul>
</li>
</ul>
<p><strong>Instead of squeezing signal out of a lot of noise, Intrusion Detection Honeypots enable D&R teams to create their own signal!</strong></p>
<h1 id=deception>Deception</h1>
<p>I&rsquo;ve made my case as to why Intrusion Detection Honeypots can aid immensly in detecting attacks, but there is one more benefit I&rsquo;d like to bring up and that is the addition of <strong>deception</strong>. A well designed IDH system can not only detect an attacker in your environment, but can actively lure the attackers <em>away</em> from the resources you are trying to protect (ex. customer data, production servers, etc.) and into a safe, controlled environment.</p>
<p>For example:</p>
<p>Let&rsquo;s say an attacker lands onto a server in your environment. There are 3 paths they realize they could take: IAM credentials, SSH keys, and an RDP windows server. Little does the attacker know, only the SSH keys are legitimate and lead to their target; the IAM creds and windows servers are actually honeypots!</p>
<p><img src=/blog/idh_example.png#c alt="IDH Example">
<p style=text-align:center>
<i>Sample honeypot system</i>
</p></p>
<p>If the attacker finds either the honey IAM creds or honey Windows server to be attractive enough to presue, the IDH effectively lures them away from the actual attack path and into a rabbit hole that leads them to an S3 bucket with a whole lot of valueless data. In addition, the Incident Response (IR) team is getting notified on every move the attacker makes on the honeypots. <strong>Even if it only takes the attacker 10 minutes to realize they were deceived, that is an extra 10 minutes the IR gets back to contain the threat!</strong></p>
<h1 id=detection--response-------deception>Detection & Response &ndash; & Deception</h1>
<p>Intrusion Detection Honeypots are extremely high signal, easy to deploy, and go above the D&R call of duty by not only detecting attacks but actively deceiving the attacker away from their target. I envision a future where honeypots are included at the core of a D&R program and deception becomes an additional feature that the team uses to increase their odds in stopping attacks and providing value to the org and security team.</p>
<p>We can be called D&R&D <em>(ok, I&rsquo;m half kidding.)</em></p>
</div>
</div>
</section>
<script src=/js/copycode.js></script>
<section class=section>
<div class="container has-text-centered">
<p></p>
</div>
</section>
</body>
</html>